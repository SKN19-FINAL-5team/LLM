#     

****: 2026-01-06  
****:  (ddoksori_demo)

---

##    (Clarification)

###   

#### 1.   

|  |  |   |
|--------|------|----------|
| **law/** () |       |  |
| **criteria/** () |       |  |
| **dispute_resolution/** () |       |   |
| **compensation_case/** () |       |   |

#### 2. RAG 

```
[ ]
    ↓
[law + criteria ]
    ↓
[ : KCA/KCDRC/ECMC]
    ↓
[  ]
    ↓
[ →   ]
    ↓
[LLM  ]
```

---

##   

### 1.   

####   
- **CHECK   **: `chunk_index >= 0` (0-based indexing)
- **doc_type **: criteria, guideline  
- **drop  **:   ( )
- **  **:   
- **search_similar_chunks  **:    (doc_type, chunk_type, source_org, min_similarity)

####  
- `/home/maroco/ddoksori_demo/backend/database/schema_v2_final.sql`

---

### 2.   

#### 2.1   

|   |   |  doc_id |
|-----------|---------|------------|
| **law** |  (law_id) | `statute:001706` () |
| **criteria_item** |    | `criteria:table1` |
| **criteria_resolution** |    | `criteria:table2` |
| **mediation_case** |  (case_no) | `kca:mediation:201527` |
| **counsel_case** |   | `consumer.go.kr:consumer_counsel_case:53321` |

#### 2.2   

- **chunk_index**: **0 ** (0-based indexing)
- **chunk_total**:      
- **chunk_id **: `{source}:{doc_type}:{identifier}:{chunk_type}:{index}`

#### 2.3   

- **      **   
-  API   (KURE-v1 )
-  : 32~64

#### 2.4    

- `table2_resolution_row_chunks.jsonl` `laws` 
- **metadata JSONB ** 
-   JSONB   

#### 2.5 drop  

- `ecmc_final_rag_chunks_normalized.jsonl`  `drop: true` 
- **DB  drop=TRUE **
-   `WHERE drop = FALSE`  

---

### 3.   

#### 3.1  

```
[JSONL  ]
    ↓
[(documents) ]
     doc_id 
     doc_type 
     category_path 
     metadata 
    ↓
[(chunks) ]
     chunk_id 
     chunk_index  (0)
     chunk_total 
     content 
    ↓
[PostgreSQL ]
     documents 
     chunks 
```

#### 3.2   

```python
class DataTransformer:
    def transform_law_data(file_path)
    def transform_criteria_table1(file_path)
    def transform_criteria_table2(file_path)
    def transform_mediation_kca(file_path)
    def transform_mediation_ecmc(file_path)
    def transform_counsel_case(file_path)
```

#### 3.3  

1. ** ** (11 )
2. ** ** (6 )
3. **** (3 )
4. **** (3 )

---

### 4.  

#### 4.1 1:     

```python
def determine_agency(user_query: str) -> str:
    """
    law + criteria      
    
    Returns:
        'KCA' | 'ECMC' | 'KCDRC'
    """
    query_embedding = get_embedding(user_query)
    
    # law + criteria 
    results = search_similar_chunks(
        query_embedding,
        doc_type_filter=['law', 'criteria_item', 'criteria_resolution'],
        top_k=10
    )
    
    #     
    agency = analyze_domain(results)
    return agency
```

**  **:
- **ECMC**: ,   
- **KCDRC**:    ( )
- **KCA**:    

#### 4.2 2:   

```python
def search_similar_cases(user_query: str, agency: str):
    """
        
       
    """
    query_embedding = get_embedding(user_query)
    
    # 1.   (  O)
    mediation_results = search_similar_chunks(
        query_embedding,
        doc_type_filter='mediation_case',
        source_org_filter=agency,
        top_k=5,
        min_similarity=0.7
    )
    
    if len(mediation_results) >= 3:
        return mediation_results
    
    # 2.   (  X)
    counsel_results = search_similar_chunks(
        query_embedding,
        doc_type_filter='counsel_case',
        top_k=5,
        min_similarity=0.6
    )
    
    return mediation_results + counsel_results
```

---

### 5.  

#### 5.1  

****: `/home/maroco/ddoksori_demo/backend/scripts/visualize_transformation.py`

****:
1. ** **: / ,  
2. **  **: ///
3. ** **:   
4. ** **:  
5. ** **:    
6. ** **: , , NULL,  

#### 5.2  

```bash
cd /home/maroco/ddoksori_demo/backend
conda activate ddoksori
python scripts/visualize_transformation.py
```

#### 5.3  

```
================================================================================
                             
================================================================================

--------------------------------------------------------------------------------
[ ]
--------------------------------------------------------------------------------
    : 16,728

   :
    - counsel_case                   15,553
    - mediation_case                  1,158
    - law                                11
    - criteria_item                       1
    - criteria_resolution                 1
    ...

--------------------------------------------------------------------------------
[ ]
--------------------------------------------------------------------------------
    : 32,456
    -  : 31,298
    -  : 1,158

   :
    - qa_combined                    15,553
    - article                         3,752
    - decision                        1,158
    - parties_claim                   1,158
    ...
```

---

##    

###   

|  |   |    |    |    |
|-----|--------|-----------|------------|------------|
| **law/** | 11 | ~4,000 | 11 | ~4,000 |
| **criteria/** | 6 | ~900 | 6 | ~900 |
| **dispute_resolution/** | 4 | ~2,300 | ~1,500 | ~3,000 |
| **compensation_case/** | 3 | ~15,000 | ~15,000 | ~15,000 |
| **** | **24** | **~22,200** | **~16,517** | **~22,900** |

---

##   

### Phase 1:    

- [x] `schema_v2_final.sql` 
- [x] CHECK   
- [x] doc_type 
- [x] drop  
- [x]   
- [x] search_similar_chunks  

### Phase 2:     ( )

** **:
1. `data_transform_pipeline.py` 
   - [ ]   
   - [ ]    (table1, table2, table3, table4, guideline)
   - [ ]    (KCA, ECMC, KCDRC)
   - [ ]   

2.    
   - [ ]    
   - [ ]    
   - [ ]   

**  **: 4~6

### Phase 3:   (Phase 2  )

** **:
1.  API  
2.   
3.   

**  **: 3~4 (   )

### Phase 4:    (Phase 3  )

** **:
1. `retriever_v2.py` 
   - [ ]   
   - [ ]   
   - [ ]    

2.    
3.  

**  **: 4~5

---

##     

###   

1. ** **
   ```bash
   cd /home/maroco/ddoksori_demo
   docker-compose up -d
   docker exec -it ddoksori_db psql -U postgres -d ddoksori -f /schema/schema_v2_final.sql
   ```

2. **    **
   - `backend/scripts/data_processing/data_transform_pipeline.py` 
   -   

3. **  **
   ```bash
   conda activate ddoksori
   python backend/scripts/visualize_transformation.py
   ```

###   

#### Q1.   
- [ ] `schema_v2_final.sql`  
- [ ]    
- [ ]  

#### Q2.   
- [ ]     ?
- [ ]   (law → criteria → mediation → counsel)?

#### Q3.   
- [ ]  GPU ?
- [ ]  GPU (RunPod) ?
- [ ]  API   

---

##   

- [    ](./____.md) -  
- [   ](./___.md) -  
- [     ](./%20%20%20%20%20.md) -  
- `backend/database/schema_v2_final.sql` -  
- `backend/scripts/visualize_transformation.py` -  

---

##  

### 
- [x] CHECK   
- [x] doc_type 
- [x] drop  
- [x]   
- [x] search_similar_chunks  
- [ ]    

###  
- [ ]   
- [ ]   
- [ ]   
- [ ]   
- [ ]  
- [ ]  

### 
- [ ]  API  
- [ ]   
- [ ]   

### 
- [ ]   
- [ ]   
- [ ]    
- [ ]  

---

****: Manus AI  
** **: 2026-01-06

****:    , Phase 1 () , Phase 2 ( )  
