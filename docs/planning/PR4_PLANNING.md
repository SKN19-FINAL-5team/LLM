# 프로젝트 계획 수정 및 PR #4 멀티 에이전트 시스템 설계

사용자님의 요구사항을 반영하여 프로젝트 계획을 다음과 같이 수정하고, PR #4에서 구현할 멀티 에이전트 시스템을 상세히 설계했습니다.

## 1. 수정된 PR 로드맵 (PR #4 ~ PR #10)

| PR | 주요 기능 | 상세 내용 |
|---|---|---|
| **PR #4** | **멀티 에이전트 RAG 시스템 구축** | - **데이터 종류 추가**: 법령, 분쟁조정기준, 상담사례 데이터 처리<br>- **에이전트 정의**: 관할위원회 판단, 분쟁조정사례 검색, 상담사례 검색<br>- **워크플로우 설계**: LangGraph를 사용한 조건부 라우팅 구현<br>- **데이터베이스 스키마 확장** |
| **PR #5** | **에이전트 성능 고도화 및 라우팅 최적화** | - **쿼리 재작성(Query Rewriting)**: 사용자 질문을 각 에이전트에 최적화된 쿼리로 변환<br>- **하이브리드 검색(Hybrid Search)**: 키워드 검색(BM25)과 벡터 검색 결합<br>- **라우팅 모델 튜닝**: LLM을 사용한 동적 라우팅 정확도 향상 |
| **PR #6** | **대화 관리 및 컨텍스트 유지** | - **대화 히스토리 저장**: PostgreSQL에 대화 로그 저장<br>- **컨텍스트 압축**: 이전 대화 내용을 요약하여 다음 턴에 활용<br>- **후속 질문 처리**: 이전 답변에 대한 후속 질문 처리 기능 구현 |
| **PR #7** | **시스템 평가 및 성능 분석 (정량)** | - **RAGAS 프레임워크 도입**: Faithfulness, Answer Relevancy, Context Precision 등 측정<br>- **평가 데이터셋 구축**: 실제 질문과 이상적인 답변으로 구성된 평가셋 생성<br>- **성능 대시보드**: 평가 결과를 시각화하여 추적 |
| **PR #8** | **피드백 시스템 및 정성 평가** | - **사용자 피드백 UI**: 답변에 대한 "좋아요/싫어요" 기능 추가<br>- **피드백 데이터 수집 및 분석**: 사용자의 피드백을 수집하여 개선점 도출<br>- **A/B 테스트**: 다양한 프롬프트와 모델을 비교 평가 |
| **PR #9** | **UI/UX 고도화** | - **반응형 웹 디자인**: 모바일 및 데스크톱 환경 최적화<br>- **답변 시각화**: 참고 자료, 출처, 유사도 등을 명확하게 표시<br>- **채팅 인터페이스 개선**: 로딩 애니메이션, 스트리밍 효과 등 적용 |
| **PR #10** | **사용자 관리, 자유게시판, 관리자 페이지** | - **사용자 인증**: 회원가입, 로그인, 소셜 로그인 기능<br>- **자유게시판**: 사용자들이 정보를 공유할 수 있는 커뮤니티 기능<br>- **관리자 페이지**: 사용자, 게시글, 채팅 로그, 시스템 상태 모니터링 |

---

## 2. PR #4: 멀티 에이전트 RAG 시스템 아키텍처

PR #4에서는 LangGraph를 사용하여 다음과 같은 워크플로우를 구현합니다.

![Multi-Agent Workflow](https://i.imgur.com/example.png)  <!-- 다이어그램 예시 이미지 -->

### 2.1. 데이터 종류 및 역할

| 데이터 종류 | 역할 | 검색 방식 | 우선순위 |
|---|---|---|---|
| **법령/분쟁조정기준** | 관할 조정위원회 판단, 법적 근거 제시 | 벡터 검색 + 키워드 검색 | 1 |
| **분쟁조정사례** | 유사 사례 제시 (실질 효력 있음) | 벡터 검색 | 2 |
| **피해구제/상담사례** | 유사 사례 제시 (실질 효력 없음) | 벡터 검색 | 3 (Fallback) |

### 2.2. 에이전트 정의

1.  **Supervisor (감독관 에이전트)**
    -   사용자 질문을 받아 어떤 에이전트를 호출할지 결정하는 라우터 역할.
    -   각 에이전트의 결과를 종합하여 최종 답변을 생성.

2.  **Jurisdiction Agent (관할위원회 판단 에이전트)**
    -   **입력**: 사용자 질문
    -   **작업**: 법령/분쟁조정기준 DB에서 관련 정보를 검색하여, 어떤 조정위원회(소비자원, 전자거래분쟁위 등)의 도움을 받아야 하는지 판단.
    -   **출력**: 관할 조정위원회 정보, 관련 법규

3.  **Precedent Agent (분쟁조정사례 검색 에이전트)**
    -   **입력**: 사용자 질문
    -   **작업**: 분쟁조정사례 DB에서 가장 유사한 사례를 검색.
    -   **출력**: 유사 분쟁조정사례 목록 (상위 N개)

4.  **Consultation Agent (상담사례 검색 에이전트)**
    -   **입력**: 사용자 질문
    -   **작업**: 피해구제/상담사례 DB에서 유사한 사례를 검색.
    -   **출력**: 유사 상담사례 목록 (상위 N개)

### 2.3. LangGraph 워크플로우 (State Graph)

1.  **Start**: 사용자 질문을 받아서 상태(State)에 저장.

2.  **Route Query (Supervisor)**: 질문의 종류에 따라 다음 노드를 결정.
    -   "이런 경우 어디에 문의해야 하나요?" → `JurisdictionAgent`
    -   "~한 피해를 입었는데 비슷한 사례가 있나요?" → `PrecedentAgent`

3.  **Execute `JurisdictionAgent`**: 관할위원회를 판단하고 결과를 상태에 추가.

4.  **Execute `PrecedentAgent`**: 분쟁조정사례를 검색하고 결과를 상태에 추가.

5.  **Check for Precedents (Conditional Edge)**: `PrecedentAgent`의 검색 결과가 있는지 확인.
    -   **결과 있음**: `Generate Final Answer`로 이동.
    -   **결과 없음**: `ConsultationAgent`로 이동 (Fallback).

6.  **Execute `ConsultationAgent`**: 상담사례를 검색하고 결과를 상태에 추가.

7.  **Generate Final Answer (Supervisor)**: 상태에 축적된 모든 정보(관할위원회, 분쟁사례/상담사례)를 종합하여 최종 답변을 생성.

8.  **End**: 최종 답변을 사용자에게 전달.

이 구조를 통해 사용자의 복잡한 의도를 단계적으로 해결하고, 데이터의 우선순위에 따라 체계적인 답변을 제공할 수 있습니다.


---

## 3. 중요 원칙: 법적 판단 금지 (Disclaimer)

본 시스템은 사용자에게 법적 조언이나 확정적인 판단을 제공하지 않습니다. LLM이 생성하는 모든 답변은 정보 제공을 목적으로 하며, 법적 효력을 갖지 않습니다.

### 3.1. 시스템 프롬프트 가이드라인

모든 LLM 에이전트(특히 Supervisor)의 시스템 프롬프트에 다음 원칙을 명시적으로 포함해야 합니다.

> **경고: 법적 판단 금지**
> - 절대로 "100% 환불받을 수 있습니다", "승소할 수 있습니다"와 같이 확정적인 판단을 내리지 마세요.
> - 항상 "유사한 사례에 따르면 ~한 결정이 내려진 적이 있습니다", "관련 법규에 따르면 ~으로 해석될 수 있습니다"와 같이 가능성을 제시하는 방식으로 답변하세요.
> - 답변 마지막에는 항상 다음과 같은 면책 조항(Disclaimer)을 포함하세요:
>   "본 답변은 제공된 정보를 바탕으로 한 참고용이며, 법적 효력을 갖지 않습니다. 정확한 판단을 위해서는 변호사 등 법률 전문가와 상담하시기 바랍니다."

### 3.2. UI/UX 가이드라인

- 채팅 화면에 "본 서비스는 법적 조언을 제공하지 않으며, 모든 답변은 참고용입니다."라는 문구를 명확하게 표시합니다.
- 사용자가 처음 서비스를 이용할 때 이 내용에 동의하도록 하는 절차를 고려할 수 있습니다.
