#     

****: 2026-01-06  
****:  (ddoksori_demo)  
** **: `backend/scripts/embedding/embed_data_remote.py`

---

##  

1. [](#)
2. [  ](#--)
3. [    ](#----)
4. [  ](#--)
5. [  ](#--)
6. [  ](#--)

---

## 

    RAG      .        ,    .

###  

-     
-     
-     
-      

---

##   

    4  :

### 1. Norm ( ) 

****:  L2 norm 0.1   

```python
norm = np.linalg.norm(vec)
if norm < 0.1:
    return True, "norm  "
```

****:           .

** **:
-      
-   
-   

### 2.  (Variance) 

****:   0.001   

```python
variance = np.var(vec)
if variance < 0.001:
    return True, "  "
```

****:         .

** **:
-   
-   
-   

### 3. NaN/Inf  

****:  NaN(Not a Number)  Inf(Infinity)    

```python
if np.isnan(vec).any() or np.isinf(vec).any():
    return True, "NaN  Inf  "
```

****:        .

** **:
-   
-   
-    

### 4.  (Sparsity) 

****:  90%  0   

```python
near_zero = np.abs(vec) < 0.001
if near_zero.sum() / len(vec) > 0.9:
    return True, " "
```

****:   0       .

** **:
-    
-   
-     

---

##     

###  

     :

```bash
#   
conda activate ddoksori
cd /home/maroco/ddoksori_demo/backend
python scripts/embed_data_remote.py
```

** **:

```
  : 1000 

    : chunk_12345
  : norm   (0.0234)
   : 5
   : " "...

 1000   
   : 15 (1.5%)
```

###  

        :

```
   
================================================================================
:                 12,150
 ():          14,898
 (/drop):     92
 ( content):    0
 :          14,806
 :        15 (0.1%)

   : 15
    : chunk_12345
    : norm   (0.0234)
     : 5
     : " "...
  ...  14
```

---

##   

### 1.     

      .

### 2.     

`verify_data()`       :

```python
pipeline = EmbeddingPipeline(db_config, embed_api_url)
pipeline.connect_db()
pipeline.verify_data()
```

** **:

```
    ( 100):
   :          100
   :      2
   :        2.0%
   :
    - norm  : 1
    -   : 1
```

### 3.   

PostgreSQL      :

```sql
--     (  )
SELECT 
    chunk_id,
    doc_id,
    content_length,
    LEFT(content, 100) as content_preview
FROM chunks
WHERE embedding IS NOT NULL
  AND drop = FALSE
ORDER BY content_length ASC
LIMIT 10;
```

---

##   

###  1: "norm  "   

****:
```
   : 150 (10.0%)
   : norm  
```

****:
-       (: " ", ". ")
-    

****:

1. **   **:
   ```python
   # data_transform_pipeline.py
   if len(content.strip()) < 10:
       chunk['drop'] = True  #  
   ```

2. ** **:
   -   /      

3. **  **:
   -     100  

###  2: "  "  

****:
```
    
  :    (0.000234)
```

****:
-   
-    
-    

****:

1. **  **:
   ```sql
   SELECT chunk_id, content
   FROM chunks
   WHERE chunk_id = '__ID';
   ```

2. **  **:
   -     
   -      

3. **  **:
   -       ,    

###  3: "NaN  Inf  "  

****:
```
    
  : NaN  Inf  
```

****:
-   
- API  
-     

****:

1. ** API **:
   ```bash
   # API   
   curl http://localhost:8001/health
   ```

2. ** **:
   -      
   -     

3. **API  **:
   ```bash
   # RunPod  
   ssh user@runpod-server
   cd /workspace
   uvicorn runpod_embed_server:app --host 0.0.0.0 --port 8000
   ```

###  4: " "  

****:
```
    
  :   (768/768  ~0)
```

****:
-    
-   
-     

****:

1. **  **:
   -    

2. **  **:
   -         
   -     

3. **  **:
   -     

---

##   

###  

```bash
# 1.  
conda activate ddoksori
cd /home/maroco/ddoksori_demo/backend

# 2.   
cat .env
# EMBED_API_URL=http://localhost:8001/embed

# 3.   (   )
python scripts/embed_data_remote.py
```

###   

```python
from pathlib import Path
from backend.scripts.embed_data_remote import EmbeddingPipeline
import os

#   
db_config = {
    'host': os.getenv('DB_HOST', 'localhost'),
    'port': int(os.getenv('DB_PORT', 5432)),
    'database': os.getenv('DB_NAME', 'ddoksori'),
    'user': os.getenv('DB_USER', 'postgres'),
    'password': os.getenv('DB_PASSWORD', 'postgres')
}

embed_api_url = os.getenv('EMBED_API_URL', 'http://localhost:8001/embed')

#  
pipeline = EmbeddingPipeline(db_config, embed_api_url)
pipeline.connect_db()

#   
json_file = Path("backend/data/transformed/mediation_kca.json")
pipeline.process_json_file(json_file)

#  
pipeline.print_stats()
pipeline.close_db()
```

###   

```python
#        
pipeline = EmbeddingPipeline(db_config, embed_api_url)
pipeline.connect_db()
pipeline.verify_data()  #   
pipeline.close_db()
```

---

##   

       :

```python
# embed_data_remote.py is_low_quality_embedding  

def is_low_quality_embedding(self, embedding: List[float]) -> Tuple[bool, str]:
    vec = np.array(embedding)
    
    #    (  )
    norm = np.linalg.norm(vec)
    if norm < 0.2:  # : 0.1
        return True, f"norm   ({norm:.4f})"
    
    variance = np.var(vec)
    if variance < 0.01:  # : 0.001
        return True, f"   ({variance:.6f})"
    
    # ...  
```

** **:
-    RAG    
-        
-        

---

##  

- [    ](./____.md)
- [     ](./%20%20%20%20%20.md)
- [RAG    ](../.cursor/plans/____22a4ef1e.plan.md)

---

##  

        :

1. ** **:   
2. ** **:     
3. ** **:    ID  
4. ** **: 
   -   
   - Python 
   -  

---

** **: 2026-01-06
