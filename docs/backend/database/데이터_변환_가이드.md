#     

****: 2026-01-06  
****:   RAG    

---

##   

```
1.  
    ↓
2.   (JSON )
    ↓
3.   
    ↓
4. DB  ()
    ↓
5.  
    ↓
6. RAG 
```

---

##   

### Step 1:  

```bash
# 1.   
cd /home/maroco/ddoksori_demo

# 2. Conda  
conda activate ddoksori

# 3.   
cat backend/.env

#   :
# - DB_HOST=localhost
# - DB_PORT=5432
# - DB_NAME=ddoksori
# - DB_USER=postgres
# - DB_PASSWORD=your_password
# - EMBED_API_URL=http://localhost:8001/embed
```

### Step 2:  

```bash
# 1. Docker  
docker-compose up -d

# 2.    
docker cp backend/database/schema_v2_final.sql ddoksori_db:/tmp/schema_v2_final.sql

# 3.  
docker exec -it ddoksori_db psql -U postgres -d ddoksori -f /tmp/schema_v2_final.sql

#     (cat  )
cat backend/database/schema_v2_final.sql | docker exec -i ddoksori_db psql -U postgres -d ddoksori

# 4.  
docker exec -it ddoksori_db psql -U postgres -d ddoksori -c "\dt"
# : documents, chunks, chunk_relations  

docker exec -it ddoksori_db psql -U postgres -d ddoksori -c "SELECT * FROM v_data_statistics;"
# :   ()
```

### Step 3:   (JSON )

```bash
#    (JSON  )
#     !
#        !

#  1: backend  ()
cd backend
python scripts/data_transform_pipeline.py

#  2:  
python backend/scripts/data_processing/data_transform_pipeline.py

#  3: scripts 
cd backend/scripts
python data_transform_pipeline.py

#  :
#    
# ================================================================================
#   
# ================================================================================
# 
# ================================================================================
# 1.   
# ================================================================================
#    : backend/data/law/Civil_Law_chunks.jsonl
#    : 792  ( )
#    : backend/data/transformed/law_civil_law.json
# 
# ...
# 
# ================================================================================
#   
# ================================================================================
#   -  : 11,976
#   -  : 14,337
#   - : 0
#   -  : 14,027 
#   - : 0
# 
#   !  backend/data/transformed/  .
```

** **:
-  ** **:         
-  ** **: , ,     
-  **  **:    `drop=True` 

  [    ](./____.md)  .

** **:
- `backend/data/transformed/law_civil_law.json`
- `backend/data/transformed/criteria_table2.json`
- `backend/data/transformed/mediation_kca.json`
- `backend/data/transformed/mediation_ecmc.json`
- `backend/data/transformed/counsel_cs_114.json`
- `backend/data/transformed/transformation_summary.json`

### Step 4:   

```bash
#  
python scripts/validate_transformed_data.py

#  :
# ================================================================================
#   
# ================================================================================
#  : law_civil_law.json
#  : criteria_table2.json
#  : mediation_kca.json
#  : mediation_ecmc.json
#  : counsel_cs_114.json
# 
#  5   
# 
# ================================================================================
#   
# ================================================================================
# ...
# 
# ================================================================================
#    
# ================================================================================
# ...
# 
# ================================================================================
#  
# ================================================================================
# 
#  :
#   -  : 16,728
#   -  : 22,456
# 
#  :
#   - : 0
#   - : 5
# 
# ================================================================================
#   !   .
# ================================================================================
# 
#    : backend/data/transformed/validation_result.json
```

** **:
-  chunk_index 0 
-  chunk_index 
-  chunk_total 
-  chunk_index < chunk_total
-    
-  content  
-     (100-2000 )
-   /  
-    

### Step 5:    ()

```bash
# JSON   
cd backend/data/transformed

# 1.   
cat transformation_summary.json | jq '.'

# 2.   
cat validation_result.json | jq '.stats'

# 3.   
cat law_civil_law.json | jq '.documents[0]'

# 4.   
cat mediation_kca.json | jq '.documents[0].chunks[0]'
```

### Step 6: DB  (TODO)

 `data_transform_pipeline.py` JSON .
DB     .

```python
# TODO: data_transform_pipeline.py 
# use_db=True  DB  
```

** **: PostgreSQL COPY  

```bash
# JSON SQL INSERT   (  )
python scripts/json_to_sql.py

#  Python psycopg2  
```

### Step 7:  

```bash
# 1.    ( )
cd backend
python runpod_embed_server.py

# :
# INFO:     Started server process
# INFO:     Uvicorn running on http://0.0.0.0:8001

# 2.   ( )
cd backend
python scripts/embed_data.py

#   GPU 
python scripts/embed_data_remote.py
```

### Step 8: RAG 

####  1:   (  )

```bash
cd backend
python scripts/test_rag_simple.py --test

#  :
# ================================================================================
#   
# ================================================================================
# 
#   :
#   - law: 11
#   - criteria_resolution: 1
#   - mediation_case: 1,158
#   - counsel_case: 15,553
# 
#   :
#   [mediation_case]
#     -  : 3,474
#     -  : 3,474 (100.0%)
#     -  : 3,474
#   [counsel_case]
#     -  : 15,553
#     -  : 15,553 (100.0%)
#     -  : 15,553
# 
#     :
#    mediation_case:  
#    counsel_case:  
# 
#  RAG   !
# 
# ================================================================================
# RAG   
# ================================================================================
# 
# --------------------------------------------------------------------------------
#   :     .    ?
#    top_k: 3, min_similarity: 0.5
#        
#     3  
# 
# ================================================================================
#  
# ================================================================================
# 
# [1] : 0.8234
#      : mediation_case
#     : KCA
#     : 201527 
#      ID: kca:mediation:201527:decision:0000
#      : decision
#     : 123
#     :   10,000,000 ...
#     : 201527
#     : 2015.05.11
# 
# ...
```

####  2:  

```bash
cd backend
python scripts/test_rag_simple.py

#   
 :   

#   ...

 : quit  # 
```

---

##   

###   

|   |   |   |   |
|-----------|--------|--------|---------|
| law | 11 | ~4,000 | ~2MB |
| criteria | 6 | ~900 | ~500KB |
| mediation | ~1,500 | ~3,500 | ~1.5MB |
| counsel | ~15,000 | ~15,000 | ~8MB |
| **** | **~16,517** | **~23,400** | **~12MB** |

###   

|  |   |   |  |
|-----|--------|---------|------|
|  GPU (RTX 3090) | 23,400 | ~20 |  |
| RunPod (RTX 4090) | 23,400 | ~15 | $1~2 |
| CPU | 23,400 | ~2 |  |

---

##   

###   

- [ ] `backend/data/transformed/`  JSON  
- [ ] `transformation_summary.json`   
- [ ]   `doc_id`, `title`, `chunks` 
- [ ]   `chunk_index`, `chunk_total` 
- [ ] chunk_index 0 
- [ ] chunk_index < chunk_total

###  

- [ ] `validation_result.json` 
- [ ] `valid: true` 
- [ ] `issues_count: 0` 
- [ ]    (    )

### DB  

- [ ] `SELECT COUNT(*) FROM documents;` →  
- [ ] `SELECT COUNT(*) FROM chunks;` →  
- [ ] `SELECT MIN(chunk_index) FROM chunks;` → 0
- [ ] `SELECT COUNT(*) FROM chunks WHERE chunk_index >= chunk_total;` → 0

###  

- [ ] `SELECT COUNT(*) FROM chunks WHERE embedding IS NOT NULL;` →   
- [ ] `SELECT array_length(embedding::real[], 1) FROM chunks LIMIT 1;` → 1024

### RAG  

- [ ]   
- [ ]  0.0~1.0 
- [ ]    

---

##   

###  1:   

```
 ValueError: Invalid chunk_index for doc1
```

****:
1. `data_transform_pipeline.py` 
2. `_assign_chunk_indices()`    
3.       

###  2:  

```
  !     .
```

****:
1. `validation_result.json` 
2. `issues`    
3.   JSON   
4.     

###  3:  API  

```
  API : Connection refused
```

****:
1.     
   ```bash
   curl http://localhost:8001/
   ```
2.    (`backend/.env` `EMBED_API_URL`)
3.   

###  4: RAG   

```
 RAG    .
```

****:
1.  DB  
   ```sql
   SELECT COUNT(*) FROM chunks;
   ```
2.   
   ```sql
   SELECT COUNT(*) FROM chunks WHERE embedding IS NOT NULL;
   ```
3.    
   ```sql
   SELECT doc_type, COUNT(*) FROM documents GROUP BY doc_type;
   ```

---

##   

###  
- [x]   (`schema_v2_final.sql`)
- [x] chunk_index  
- [x]    (JSON )
- [x]    
- [x]  RAG  
- [x]    (/ )
- [x]   

###   
- [ ]   
- [ ]   
- [ ]  DB 

###   ⏳
- [ ] DB   
- [ ]  
- [ ]  RAG  
- [ ]  

---

##   

- [    ](./____.md)  **NEW**
- [    ](./____.md)
- [chunk_index  ](./chunk_index__.md)
- [    ](./____.md)
- [   ](./___.md)

---

****: Manus AI  
** **: 2026-01-06  
****:       
