# ë¡œì»¬ RAG ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

**ì‘ì„±ì¼**: 2026-01-09  
**ëª©ì **: ë¡œì»¬ í™˜ê²½ì—ì„œ Hybrid Search, BM25, Cosine Similarity ê¸°ë°˜ RAG ì‹œìŠ¤í…œì„ ì‰½ê²Œ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [ì‚¬ì „ ì¤€ë¹„](#ì‚¬ì „-ì¤€ë¹„)
3. [ê¸°ë³¸ ì‚¬ìš©ë²•](#ê¸°ë³¸-ì‚¬ìš©ë²•)
4. [ê²°ê³¼ í•´ì„](#ê²°ê³¼-í•´ì„)
5. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)
6. [ì°¸ê³  ë¬¸ì„œ](#ì°¸ê³ -ë¬¸ì„œ)

---

## ê°œìš”

ì´ ê°€ì´ë“œëŠ” ë¡œì»¬ í™˜ê²½ì—ì„œ RAG ì‹œìŠ¤í…œì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤. 3ê°€ì§€ ê²€ìƒ‰ ë°©ë²•(Hybrid Search, BM25, Cosine Similarity)ì„ ë¹„êµí•˜ê³ , LLMì´ ê° ë°©ë²•ì˜ ê²°ê³¼ë¥¼ ë¶„ì„í•˜ì—¬ ìµœì¢… ë‹µë³€ì„ ìƒì„±í•©ë‹ˆë‹¤.

### ì£¼ìš” ê¸°ëŠ¥

- **3ê°€ì§€ ê²€ìƒ‰ ë°©ë²• ë¹„êµ**: Hybrid Search, BM25, Cosine Similarity
- **LLM ë¹„êµ ë¶„ì„**: ê° ê²€ìƒ‰ ë°©ë²•ì˜ ê²°ê³¼ë¥¼ ì¢…í•©í•˜ì—¬ ìµœì¢… ë‹µë³€ ìƒì„±
- **ì¸í„°ë™í‹°ë¸Œ ëª¨ë“œ**: ëŒ€í™”í˜•ìœ¼ë¡œ ì—¬ëŸ¬ ì¿¼ë¦¬ë¥¼ í…ŒìŠ¤íŠ¸
- **ìƒì„¸ ê²°ê³¼ ì¶œë ¥**: ê° ê²€ìƒ‰ ë°©ë²•ë³„ ìƒì„¸ ê²°ê³¼ í™•ì¸ ê°€ëŠ¥

### ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
ì‚¬ìš©ì ì§ˆë¬¸ ì…ë ¥
    â†“
MultiMethodRetriever
    â”œâ”€ Cosine Similarity ê²€ìƒ‰ (ë²¡í„° ìœ ì‚¬ë„)
    â”œâ”€ BM25 ê²€ìƒ‰ (í‚¤ì›Œë“œ ê¸°ë°˜)
    â””â”€ Hybrid Search ê²€ìƒ‰ (ë²¡í„° + í‚¤ì›Œë“œ ê²°í•©)
    â†“
ê° ê²€ìƒ‰ ë°©ë²•ë³„ ê²°ê³¼ ìˆ˜ì§‘
    â†“
RAGGenerator.generate_comparative_answer()
    â”œâ”€ ê° ê²€ìƒ‰ ë°©ë²•ì˜ ê²°ê³¼ë¥¼ êµ¬ì¡°í™”
    â”œâ”€ LLMì— ë¹„êµ ë¶„ì„ í”„ë¡¬í”„íŠ¸ ì „ë‹¬
    â””â”€ ìµœì¢… ë‹µë³€ ìƒì„±
    â†“
ê²°ê³¼ ì¶œë ¥ (ê²€ìƒ‰ ìš”ì•½ + LLM ë¶„ì„)
```

---

## ì‚¬ì „ ì¤€ë¹„

### 1. Conda í™˜ê²½ í™œì„±í™”

í”„ë¡œì íŠ¸ëŠ” `dsr` conda í™˜ê²½ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ë¨¼ì € í™˜ê²½ì„ í™œì„±í™”í•˜ì„¸ìš”:

```bash
conda activate dsr
```

**ì˜ˆìƒ ì¶œë ¥**:
```
(dsr) user@hostname:~/LLM$
```

### 2. í™˜ê²½ ë³€ìˆ˜ í™•ì¸

`.env` íŒŒì¼ì— í•„ìš”í•œ ì„¤ì •ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”:

```bash
cd /home/maroco/LLM/backend
cat .env | grep -E "OPENAI_API_KEY|DB_HOST|DB_NAME"
```

**í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜**:
- `OPENAI_API_KEY`: OpenAI API í‚¤ (LLM ë‹µë³€ ìƒì„±ì— í•„ìš”)
- `DB_HOST`: ë°ì´í„°ë² ì´ìŠ¤ í˜¸ìŠ¤íŠ¸ (ê¸°ë³¸ê°’: localhost)
- `DB_PORT`: ë°ì´í„°ë² ì´ìŠ¤ í¬íŠ¸ (ê¸°ë³¸ê°’: 5432)
- `DB_NAME`: ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„ (ê¸°ë³¸ê°’: ddoksori)
- `DB_USER`: ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©ì (ê¸°ë³¸ê°’: postgres)
- `DB_PASSWORD`: ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸

**`.env` íŒŒì¼ ì˜ˆì‹œ**:
```env
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
DB_HOST=localhost
DB_PORT=5432
DB_NAME=ddoksori
DB_USER=postgres
DB_PASSWORD=postgres
```

### 3. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸

PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”:

```bash
# Docker ì»¨í…Œì´ë„ˆ í™•ì¸ (Docker ì‚¬ìš© ì‹œ)
docker ps | grep ddoksori_db

# ë˜ëŠ” ì§ì ‘ ì—°ê²° í…ŒìŠ¤íŠ¸
psql -h localhost -U postgres -d ddoksori -c "SELECT COUNT(*) FROM chunks;"
```

**ì˜ˆìƒ ì¶œë ¥**:
```
 count 
-------
  1234
(1 row)
```

ë°ì´í„°ê°€ ì—†ê±°ë‚˜ ì—°ê²°ì´ ì•ˆ ë˜ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.

---

## ê¸°ë³¸ ì‚¬ìš©ë²•

### ë°©ë²• 1: ì¸í„°ë™í‹°ë¸Œ ëª¨ë“œ (ì¶”ì²œ)

ëŒ€í™”í˜•ìœ¼ë¡œ ì—¬ëŸ¬ ì¿¼ë¦¬ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```bash
cd /home/maroco/LLM/backend
conda activate dsr
python scripts/test_rag_local_simple.py
```

**ì‹¤í–‰ ì˜ˆì‹œ**:
```
================================================================================
ğŸ¯ RAG ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ (ì¸í„°ë™í‹°ë¸Œ ëª¨ë“œ)
================================================================================

ì¢…ë£Œí•˜ë ¤ë©´ 'quit', 'exit', ë˜ëŠ” 'q'ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
ìƒì„¸ ê²°ê³¼ë¥¼ ë³´ë ¤ë©´ ì¿¼ë¦¬ ì•ì— '--detail' ë˜ëŠ” '-d'ë¥¼ ë¶™ì´ì„¸ìš”.
ì˜ˆ: --detail ëƒ‰ì¥ê³  í™˜ë¶ˆ ì‚¬ë¡€

ê²€ìƒ‰ ì¿¼ë¦¬ ì…ë ¥: 
```

**ì‚¬ìš© ì˜ˆì‹œ**:
1. ê¸°ë³¸ ê²€ìƒ‰:
   ```
   ê²€ìƒ‰ ì¿¼ë¦¬ ì…ë ¥: ëƒ‰ì¥ê³  í™˜ë¶ˆ ì‚¬ë¡€
   ```

2. ìƒì„¸ ê²°ê³¼ í¬í•¨:
   ```
   ê²€ìƒ‰ ì¿¼ë¦¬ ì…ë ¥: --detail ëƒ‰ì¥ê³  í™˜ë¶ˆ ì‚¬ë¡€
   ```

3. ì¢…ë£Œ:
   ```
   ê²€ìƒ‰ ì¿¼ë¦¬ ì…ë ¥: quit
   ```

### ë°©ë²• 2: ë‹¨ì¼ ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸

ëª…ë ¹ì¤„ì—ì„œ ì§ì ‘ ì¿¼ë¦¬ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```bash
cd /home/maroco/LLM/backend
conda activate dsr
python scripts/test_rag_local_simple.py --query "ëƒ‰ì¥ê³  í™˜ë¶ˆ ì‚¬ë¡€"
```

### ë°©ë²• 3: ìƒì„¸ ê²°ê³¼ í¬í•¨

ê° ê²€ìƒ‰ ë°©ë²•ë³„ ìƒì„¸ ê²°ê³¼ë¥¼ ë³´ë ¤ë©´ `--detail` ì˜µì…˜ì„ ì‚¬ìš©í•˜ì„¸ìš”:

```bash
cd /home/maroco/LLM/backend
conda activate dsr
python scripts/test_rag_local_simple.py --query "ëƒ‰ì¥ê³  í™˜ë¶ˆ ì‚¬ë¡€" --detail
```

### ë°©ë²• 4: Top-K ì¡°ì •

ê° ê²€ìƒ‰ ë°©ë²•ë³„ ë°˜í™˜í•  ê²°ê³¼ ìˆ˜ë¥¼ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```bash
cd /home/maroco/LLM/backend
conda activate dsr
python scripts/test_rag_local_simple.py --query "ëƒ‰ì¥ê³  í™˜ë¶ˆ ì‚¬ë¡€" --top-k 5
```

---

## ê²°ê³¼ í•´ì„

### ì¶œë ¥ êµ¬ì¡°

ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì‹œ ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì¡°ë¡œ ê²°ê³¼ê°€ ì¶œë ¥ë©ë‹ˆë‹¤:

```
================================================================================
ğŸ“ ê²€ìƒ‰ ì¿¼ë¦¬: ëƒ‰ì¥ê³  í™˜ë¶ˆ ì‚¬ë¡€
================================================================================

ğŸ” ê²€ìƒ‰ ë°©ë²•: cosine, bm25, hybrid
ğŸ“Š ê° ë°©ë²•ë³„ Top-10 ê²°ê³¼ ê²€ìƒ‰ ì¤‘...

ğŸ“ˆ ê²€ìƒ‰ ê²°ê³¼ ìš”ì•½:
--------------------------------------------------------------------------------
  âœ… COSINE  :  10ê°œ ê²°ê³¼ ( 234.5ms)
  âœ… BM25    :   8ê°œ ê²°ê³¼ ( 156.2ms)
  âœ… HYBRID  :  10ê°œ ê²°ê³¼ ( 445.8ms)
--------------------------------------------------------------------------------

================================================================================
ğŸ¤– LLM ë¹„êµ ë¶„ì„ ì¤‘...
================================================================================

[ê²€ìƒ‰ ë°©ë²•ë³„ ìš”ì•½]
- COSINE: 10ê°œ ê²°ê³¼ (0.235ì´ˆ)
- BM25: 8ê°œ ê²°ê³¼ (0.156ì´ˆ)
- HYBRID: 10ê°œ ê²°ê³¼ (0.446ì´ˆ)

[ì¢…í•© ë‹µë³€]
ê° ê²€ìƒ‰ ë°©ë²•ì—ì„œ ì°¾ì€ ê²°ê³¼ë¥¼ ì¢…í•©í•˜ë©´...

[ì°¸ê³  ì¶œì²˜]
- ê²€ìƒ‰ ë°©ë²•: COSINE, BM25, HYBRID
- ì‚¬ê±´ë²ˆí˜¸: KCA-2024-001234
...

--------------------------------------------------------------------------------
ğŸ“Š ê²€ìƒ‰ í†µê³„:
  - ì‚¬ìš©ëœ ê²€ìƒ‰ ë°©ë²•: cosine, bm25, hybrid
  - ì´ ê²€ìƒ‰ ê²°ê³¼ ìˆ˜: 28ê°œ
  - ì‚¬ìš©ëœ í† í° ìˆ˜: 1,234ê°œ
    (í”„ë¡¬í”„íŠ¸: 1,000, ìƒì„±: 234)
--------------------------------------------------------------------------------
```

### ê° ì„¹ì…˜ ì„¤ëª…

1. **ê²€ìƒ‰ ê²°ê³¼ ìš”ì•½**
   - ê° ê²€ìƒ‰ ë°©ë²•ë³„ë¡œ ì°¾ì€ ê²°ê³¼ ìˆ˜ì™€ ì†Œìš” ì‹œê°„
   - âœ…: ì„±ê³µ, âŒ: ì‹¤íŒ¨

2. **LLM ë¹„êµ ë¶„ì„**
   - ê° ê²€ìƒ‰ ë°©ë²•ì˜ ê²°ê³¼ë¥¼ ì¢…í•©í•œ ìµœì¢… ë‹µë³€
   - ê²€ìƒ‰ ë°©ë²•ë³„ ìš”ì•½ í¬í•¨
   - ì°¸ê³  ì¶œì²˜ ëª…ì‹œ

3. **ê²€ìƒ‰ í†µê³„**
   - ì‚¬ìš©ëœ ê²€ìƒ‰ ë°©ë²• ëª©ë¡
   - ì´ ê²€ìƒ‰ ê²°ê³¼ ìˆ˜
   - LLM í† í° ì‚¬ìš©ëŸ‰

### ìƒì„¸ ê²°ê³¼ ë³´ê¸°

`--detail` ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ê° ê²€ìƒ‰ ë°©ë²•ë³„ ìƒì„¸ ê²°ê³¼ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```
ğŸ“‹ ìƒì„¸ ê²€ìƒ‰ ê²°ê³¼:
================================================================================

[COSINE] ìƒìœ„ 10ê°œ ê²°ê³¼:
--------------------------------------------------------------------------------

1. ì ìˆ˜: 0.8234
   ì¶œì²˜: mediation_case
   ì‚¬ê±´ë²ˆí˜¸: KCA-2024-001234
   ê¸°ê´€: kca
   ê²°ì •ì¼ì: 2024-01-15
   ë‚´ìš©: ëƒ‰ì¥ê³  êµ¬ë§¤ í›„ ëƒ‰ë™ì‹¤ì´ ì‘ë™í•˜ì§€ ì•Šì•„ í™˜ë¶ˆì„ ìš”ì²­í•œ ì‚¬ë¡€...

2. ì ìˆ˜: 0.7891
   ì¶œì²˜: counsel_case
   ...
```

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: "ModuleNotFoundError: No module named 'app'"

**ì›ì¸**: í”„ë¡œì íŠ¸ ê²½ë¡œê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì§€ ì•ŠìŒ

**í•´ê²° ë°©ë²•**:
```bash
# í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ ì‹¤í–‰
cd /home/maroco/LLM
conda activate dsr
python backend/scripts/test_rag_local_simple.py --query "í…ŒìŠ¤íŠ¸"
```

### ë¬¸ì œ 2: "BM25 Retriever ì´ˆê¸°í™” ì‹¤íŒ¨"

**ì›ì¸**: BM25 ëª¨ë“ˆì„ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨

**í•´ê²° ë°©ë²•**:
1. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸:
   ```bash
   psql -h localhost -U postgres -d ddoksori -c "SELECT 1;"
   ```

2. í™˜ê²½ ë³€ìˆ˜ í™•ì¸:
   ```bash
   cat backend/.env | grep DB_
   ```

### ë¬¸ì œ 3: "OpenAI API ì˜¤ë¥˜"

**ì›ì¸**: OpenAI API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•ŠìŒ

**í•´ê²° ë°©ë²•**:
```bash
# .env íŒŒì¼ í™•ì¸
cat backend/.env | grep OPENAI_API_KEY

# API í‚¤ê°€ ì—†ìœ¼ë©´ ì¶”ê°€
echo "OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" >> backend/.env
```

### ë¬¸ì œ 4: "ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨"

**ì›ì¸**: PostgreSQLì´ ì‹¤í–‰ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ì—°ê²° ì •ë³´ê°€ ì˜ëª»ë¨

**í•´ê²° ë°©ë²•**:
```bash
# Docker ì»¨í…Œì´ë„ˆ í™•ì¸ ë° ì‹œì‘
docker ps -a | grep ddoksori_db
docker start ddoksori_db

# ë˜ëŠ” ì§ì ‘ PostgreSQL í™•ì¸
sudo systemctl status postgresql
```

### ë¬¸ì œ 5: "ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤"

**ì›ì¸**: ë°ì´í„°ë² ì´ìŠ¤ì— ë°ì´í„°ê°€ ì—†ê±°ë‚˜ ì¿¼ë¦¬ê°€ ë„ˆë¬´ êµ¬ì²´ì ì„

**í•´ê²° ë°©ë²•**:
1. ë°ì´í„° í™•ì¸:
   ```bash
   psql -h localhost -U postgres -d ddoksori -c "SELECT COUNT(*) FROM chunks;"
   ```

2. ë” ì¼ë°˜ì ì¸ ì¿¼ë¦¬ ì‹œë„:
   ```
   ê²€ìƒ‰ ì¿¼ë¦¬ ì…ë ¥: í™˜ë¶ˆ
   ```

### ë¬¸ì œ 6: "Conda í™˜ê²½ì´ í™œì„±í™”ë˜ì§€ ì•ŠìŒ"

**ì›ì¸**: conda í™˜ê²½ì´ í™œì„±í™”ë˜ì§€ ì•Šì•˜ê±°ë‚˜ `dsr` í™˜ê²½ì´ ì—†ìŒ

**í•´ê²° ë°©ë²•**:
```bash
# conda í™˜ê²½ ëª©ë¡ í™•ì¸
conda env list

# dsr í™˜ê²½ì´ ì—†ìœ¼ë©´ ìƒì„± (í•„ìš”í•œ ê²½ìš°)
conda create -n dsr python=3.10
conda activate dsr

# í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install -r backend/requirements.txt
```

---

## ì°¸ê³  ë¬¸ì„œ

- [RAG CLI ì‚¬ìš© ê°€ì´ë“œ](./rag_cli_usage_guide.md): ë” ê³ ê¸‰ ê¸°ëŠ¥ì„ í¬í•¨í•œ CLI ë„êµ¬ ì‚¬ìš©ë²•
- [RAG ì•„í‚¤í…ì²˜ ì „ë¬¸ê°€ ë·°](./rag_architecture_expert_view.md): RAG ì‹œìŠ¤í…œì˜ ì „ì²´ ì•„í‚¤í…ì²˜ ì„¤ëª…
- [Vector DB ê´€ë¦¬ ê°€ì´ë“œ](./Vector_DB_ê´€ë¦¬_ê°€ì´ë“œ.md): ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ ë°©ë²•

---

## ë¹ ë¥¸ ì°¸ì¡°

### ìì£¼ ì‚¬ìš©í•˜ëŠ” ëª…ë ¹ì–´

```bash
# 1. í™˜ê²½ í™œì„±í™” ë° ì´ë™
cd /home/maroco/LLM/backend
conda activate dsr

# 2. ì¸í„°ë™í‹°ë¸Œ ëª¨ë“œ ì‹¤í–‰
python scripts/test_rag_local_simple.py

# 3. ë‹¨ì¼ ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸
python scripts/test_rag_local_simple.py --query "ëƒ‰ì¥ê³  í™˜ë¶ˆ"

# 4. ìƒì„¸ ê²°ê³¼ í¬í•¨
python scripts/test_rag_local_simple.py --query "ëƒ‰ì¥ê³  í™˜ë¶ˆ" --detail

# 5. Top-K ì¡°ì •
python scripts/test_rag_local_simple.py --query "ëƒ‰ì¥ê³  í™˜ë¶ˆ" --top-k 5
```

### ë„ì›€ë§ ë³´ê¸°

```bash
python scripts/test_rag_local_simple.py --help
```

---

**ì‘ì„±ì**: RAG ì‹œìŠ¤í…œ ê°œë°œíŒ€  
**ìµœì¢… ìˆ˜ì •ì¼**: 2026-01-09
