# ê¸´ê¸‰ ì¡°ì¹˜ ì‹¤í–‰ ê°€ì´ë“œ

**ì‘ì„±ì¼**: 2026ë…„ 1ì›” 7ì¼  
**ëŒ€ìƒ**: ê°œë°œì, PM  
**ëª©ì **: ë²•ë ¹/ê¸°ì¤€ ë°ì´í„° ì¶”ê°€ ë° ë©”íƒ€ë°ì´í„° ë³´ê°• ì‹¤í–‰ ë°©ë²•

---

## ğŸ“‹ í˜„ì¬ ìƒíƒœ ìš”ì•½

```
âœ… ë²•ë ¹ ë°ì´í„°: 12ê°œ ì‚½ì… ì™„ë£Œ (4,887ê°œ ì²­í¬)
âœ… ê¸°ì¤€ ë°ì´í„°: 4ê°œ ì‚½ì… ì™„ë£Œ (626ê°œ ì²­í¬)
âœ… ë©”íƒ€ë°ì´í„°: 99.9% í‚¤ì›Œë“œ ì¶”ì¶œ ì™„ë£Œ

âš ï¸ ì„ë² ë”© í•„ìš”: 4,325ê°œ ì²­í¬ (ìƒˆë¡œ ì¶”ê°€ëœ ë°ì´í„°)
```

**ì¤‘ìš”**: ë°ì´í„°ëŠ” DBì— ìˆì§€ë§Œ, **ì„ë² ë”©ì´ ì—†ìœ¼ë©´ ê²€ìƒ‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤!**

---

## 1. ì‚¬ì „ ì¤€ë¹„

### 1.1 í™˜ê²½ í™•ì¸

```bash
# Conda í™˜ê²½ í™œì„±í™”
conda activate ddoksori

# PostgreSQL ì‹¤í–‰ í™•ì¸
docker ps | grep postgres

# DB ì—°ê²° í…ŒìŠ¤íŠ¸
cd /home/maroco/ddoksori_demo/backend
conda run -n ddoksori python -c "
import psycopg2
import os
from dotenv import load_dotenv

load_dotenv()
conn = psycopg2.connect(
    host=os.getenv('DB_HOST', 'localhost'),
    port=os.getenv('DB_PORT', '5432'),
    database=os.getenv('DB_NAME', 'ddoksori'),
    user=os.getenv('DB_USER', 'postgres'),
    password=os.getenv('DB_PASSWORD', 'postgres')
)
print('âœ… DB ì—°ê²° ì„±ê³µ')
conn.close()
"
```

---

## 2. ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ë°©ë²•

### 2.1 ë²•ë ¹ ë°ì´í„° ì²˜ë¦¬

**íŒŒì¼**: `backend/scripts/data_loading/process_all_laws.py`

**ì‹¤í–‰**:
```bash
cd /home/maroco/ddoksori_demo/backend/scripts
conda run -n ddoksori python backend/scripts/data_loading/process_all_laws.py
```

**ì˜ˆìƒ ê²°ê³¼**:
```
================================================================================
ë²•ë ¹ ë°ì´í„° ì¼ê´„ ì²˜ë¦¬ ì‹œì‘
================================================================================
ë°œê²¬ëœ ë²•ë ¹ íŒŒì¼: 11ê°œ
  - Civil_Law_chunks.jsonl
  - Commercial_Law_chunks.jsonl
  - ...

ì²˜ë¦¬ ì¤‘: Civil_Law_chunks.jsonl
  âœ… ë¯¼ë²•: 1069ê°œ ì²­í¬
  âœ… ì™„ë£Œ: 1ê°œ ë¬¸ì„œ, 1069ê°œ ì²­í¬

...

ì²˜ë¦¬ ì™„ë£Œ
  - ì²˜ë¦¬ëœ íŒŒì¼: 11ê°œ
  - ì‚½ì…ëœ ë¬¸ì„œ: 11ê°œ
  - ì‚½ì…ëœ ì²­í¬: 3,828ê°œ
  - ì˜¤ë¥˜: 0ê°œ

âœ… ë²•ë ¹ ë°ì´í„° ì²˜ë¦¬ ì™„ë£Œ!
```

**ì¬ì‹¤í–‰ ì‹œ**:
```
  âš ï¸  ë¬¸ì„œ ì´ë¯¸ ì¡´ì¬: law:civil_law_chunks (ìŠ¤í‚µ)
  ...
  - ì‚½ì…ëœ ë¬¸ì„œ: 0ê°œ  â† ì¤‘ë³µì´ë¯€ë¡œ ì•„ë¬´ê²ƒë„ ì•ˆ í•¨
```

**í™•ì¸ ë°©ë²•**:
```bash
cd /home/maroco/ddoksori_demo/backend
conda run -n ddoksori python -c "
import psycopg2
import os
from dotenv import load_dotenv

load_dotenv()
conn = psycopg2.connect(
    host=os.getenv('DB_HOST', 'localhost'),
    port=os.getenv('DB_PORT', '5432'),
    database=os.getenv('DB_NAME', 'ddoksori'),
    user=os.getenv('DB_USER', 'postgres'),
    password=os.getenv('DB_PASSWORD', 'postgres')
)
cur = conn.cursor()
cur.execute(\"SELECT COUNT(*) FROM documents WHERE doc_type = 'law'\")
print(f'ë²•ë ¹ ë¬¸ì„œ ìˆ˜: {cur.fetchone()[0]}ê°œ')
cur.execute(\"\"\"
    SELECT COUNT(*) 
    FROM documents d 
    JOIN chunks c ON d.doc_id = c.doc_id 
    WHERE d.doc_type = 'law'
\"\"\")
print(f'ë²•ë ¹ ì²­í¬ ìˆ˜: {cur.fetchone()[0]}ê°œ')
conn.close()
"
```

---

### 2.2 ê¸°ì¤€ ë°ì´í„° ì²˜ë¦¬

**íŒŒì¼**: `backend/scripts/data_loading/process_criteria_tables.py`

**ì‹¤í–‰**:
```bash
cd /home/maroco/ddoksori_demo/backend/scripts
conda run -n ddoksori python backend/scripts/data_loading/process_criteria_tables.py
```

**ì˜ˆìƒ ê²°ê³¼**:
```
================================================================================
ê¸°ì¤€ ë°ì´í„° (table 1/3/4) ì¼ê´„ ì²˜ë¦¬ ì‹œì‘
================================================================================
íŒŒì¼ ì¡´ì¬ í™•ì¸:
  âœ… table1_item_chunks.jsonl
  âœ… table3_warranty_chunks.jsonl
  âœ… table4_lifespan_chunks.jsonl

ì²˜ë¦¬ ì¤‘: í’ˆëª© ë¶„ë¥˜ (table1_item_chunks.jsonl)
  âœ… 387ê°œ í’ˆëª© ì²­í¬
  âœ… ì™„ë£Œ: 1ê°œ ë¬¸ì„œ, 387ê°œ ì²­í¬

...

ì²˜ë¦¬ ì™„ë£Œ
  - ì²˜ë¦¬ëœ í…Œì´ë¸”: 3ê°œ
  - ì‚½ì…ëœ ë¬¸ì„œ: 3ê°œ
  - ì‚½ì…ëœ ì²­í¬: 487ê°œ
  - ì˜¤ë¥˜: 0ê°œ

âœ… ê¸°ì¤€ ë°ì´í„° ì²˜ë¦¬ ì™„ë£Œ!
```

**í™•ì¸ ë°©ë²•**:
```bash
cd /home/maroco/ddoksori_demo/backend
conda run -n ddoksori python -c "
import psycopg2
import os
from dotenv import load_dotenv

load_dotenv()
conn = psycopg2.connect(
    host=os.getenv('DB_HOST', 'localhost'),
    port=os.getenv('DB_PORT', '5432'),
    database=os.getenv('DB_NAME', 'ddoksori'),
    user=os.getenv('DB_USER', 'postgres'),
    password=os.getenv('DB_PASSWORD', 'postgres')
)
cur = conn.cursor()
cur.execute(\"SELECT doc_id, title FROM documents WHERE doc_type LIKE '%criteria%'\")
for doc_id, title in cur.fetchall():
    print(f'{doc_id}: {title}')
conn.close()
"
```

---

### 2.3 ë©”íƒ€ë°ì´í„° í‚¤ì›Œë“œ ì¶”ì¶œ

**íŒŒì¼**: `backend/scripts/utilities/update_metadata_keywords.py`

**ì‹¤í–‰**:
```bash
cd /home/maroco/ddoksori_demo/backend/scripts
conda run -n ddoksori python backend/scripts/utilities/update_metadata_keywords.py
```

**ì˜ˆìƒ ê²°ê³¼**:
```
================================================================================
ë©”íƒ€ë°ì´í„° í‚¤ì›Œë“œ ì¶”ì¶œ ì‹œì‘
================================================================================
âœ… DB ì—°ê²° ì„±ê³µ
âœ… MetadataEnricher ì´ˆê¸°í™” ì™„ë£Œ

ë¬¸ì„œ ëª©ë¡ ê°€ì ¸ì˜¤ëŠ” ì¤‘...
âœ… 11,985ê°œ ë¬¸ì„œ ë°œê²¬

ë©”íƒ€ë°ì´í„° ì¶”ì¶œ ë° ì—…ë°ì´íŠ¸ ì‹œì‘...
ë¬¸ì„œ ID                                              ìƒíƒœ         í‚¤ì›Œë“œ ìˆ˜      ì§„í–‰ë¥        
--------------------------------------------------------------------------------
counsel_case:1000001                               âœ…          15            0.0%
counsel_case:1000002                               âœ…          15            0.0%
...

================================================================================
ë©”íƒ€ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ
================================================================================
  - ì´ ë¬¸ì„œ: 11,985ê°œ
  - ì—…ë°ì´íŠ¸ ì„±ê³µ: 11,985ê°œ
  - ì˜¤ë¥˜: 0ê°œ
  - ì†Œìš” ì‹œê°„: 0.2ë¶„

ë©”íƒ€ë°ì´í„° ì»¤ë²„ë¦¬ì§€ í™•ì¸:
ë¬¸ì„œ íƒ€ì…                          ì´ ë¬¸ì„œ       í‚¤ì›Œë“œ ìˆìŒ          ì»¤ë²„ë¦¬ì§€      
--------------------------------------------------------------------------------
counsel_case                   11342      11342            100.0%
law                            12         12               100.0%
...

âœ… ë©”íƒ€ë°ì´í„° í‚¤ì›Œë“œ ì¶”ì¶œ ì™„ë£Œ!
```

**ì¬ì‹¤í–‰ ì‹œ**: ê¸°ì¡´ ë©”íƒ€ë°ì´í„°ì™€ ë³‘í•© (`metadata || new_metadata`)í•˜ë¯€ë¡œ ì¤‘ë³µ ê±±ì • ì—†ìŒ

---

## 3. âš ï¸ í•„ìˆ˜ ë‹¨ê³„: ì„ë² ë”© ìƒì„±

### 3.1 í˜„ì¬ ì„ë² ë”© ìƒíƒœ í™•ì¸

```bash
cd /home/maroco/ddoksori_demo/backend
conda run -n ddoksori python -c "
import psycopg2
import os
from dotenv import load_dotenv

load_dotenv()
conn = psycopg2.connect(
    host=os.getenv('DB_HOST', 'localhost'),
    port=os.getenv('DB_PORT', '5432'),
    database=os.getenv('DB_NAME', 'ddoksori'),
    user=os.getenv('DB_USER', 'postgres'),
    password=os.getenv('DB_PASSWORD', 'postgres')
)
cur = conn.cursor()

# ì„ë² ë”© í•„ìš”í•œ ì²­í¬ ìˆ˜
cur.execute(\"\"\"
    SELECT 
        d.doc_type,
        COUNT(*) as total_chunks,
        COUNT(CASE WHEN c.embedding IS NULL THEN 1 END) as need_embedding
    FROM documents d
    JOIN chunks c ON d.doc_id = c.doc_id
    WHERE c.drop = FALSE
    GROUP BY d.doc_type
    ORDER BY need_embedding DESC
\"\"\")

print('ì„ë² ë”© í•„ìš” í˜„í™©:')
print(f'{\"ë¬¸ì„œ íƒ€ì…\":<30} {\"ì „ì²´ ì²­í¬\":<10} {\"ì„ë² ë”© í•„ìš”\":<10}')
print('-' * 60)
total_need = 0
for doc_type, total, need in cur.fetchall():
    if need > 0:
        print(f'{doc_type:<30} {total:<10} {need:<10}')
        total_need += need

print('-' * 60)
print(f'{\"í•©ê³„\":<30} {\"-\":<10} {total_need:<10}')

conn.close()
"
```

**ì˜ˆìƒ ê²°ê³¼**:
```
ì„ë² ë”© í•„ìš” í˜„í™©:
ë¬¸ì„œ íƒ€ì…                          ì „ì²´ ì²­í¬       ì„ë² ë”© í•„ìš”    
------------------------------------------------------------
law                            4887       3828      
criteria_item_list             387        387       
criteria_warranty              38         38        
criteria_lifespan              62         62        
------------------------------------------------------------
í•©ê³„                            -          4325      
```

### 3.2 ì„ë² ë”© ìƒì„± ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±

ê¸°ì¡´ ì„ë² ë”© ìŠ¤í¬ë¦½íŠ¸ê°€ ìˆëŠ”ì§€ í™•ì¸:
```bash
ls -la /home/maroco/ddoksori_demo/backend/scripts/*embed*.py
```

**ì—†ë‹¤ë©´ ìƒˆë¡œ ì‘ì„±**:

```python
# backend/scripts/generate_embeddings_incremental.py
#!/usr/bin/env python3
"""
ì„ë² ë”©ì´ ì—†ëŠ” ì²­í¬ì— ëŒ€í•´ì„œë§Œ ì„ë² ë”© ìƒì„±

Usage:
    conda run -n ddoksori python generate_embeddings_incremental.py
"""

import sys
from pathlib import Path
import psycopg2
import os
from dotenv import load_dotenv
import torch
from transformers import AutoModel, AutoTokenizer
from tqdm import tqdm

# í”„ë¡œì íŠ¸ ë£¨íŠ¸ ì¶”ê°€
project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root))

load_dotenv(project_root / '.env')


def get_embeddings(texts, model, tokenizer, device, batch_size=8):
    """ë°°ì¹˜ ì„ë² ë”© ìƒì„±"""
    embeddings = []
    
    for i in tqdm(range(0, len(texts), batch_size), desc="ì„ë² ë”© ìƒì„±"):
        batch = texts[i:i+batch_size]
        
        # í† í¬ë‚˜ì´ì§•
        inputs = tokenizer(
            batch,
            padding=True,
            truncation=True,
            max_length=512,
            return_tensors='pt'
        ).to(device)
        
        # ì„ë² ë”© ìƒì„±
        with torch.no_grad():
            outputs = model(**inputs)
            batch_embeddings = outputs.last_hidden_state[:, 0, :].cpu().numpy()
        
        embeddings.extend(batch_embeddings)
    
    return embeddings


def main():
    print("=" * 80)
    print("ì„ë² ë”© ìƒì„± ì‹œì‘ (ì¦ë¶„ ì²˜ë¦¬)")
    print("=" * 80)
    
    # DB ì—°ê²°
    conn = psycopg2.connect(
        host=os.getenv('DB_HOST', 'localhost'),
        port=os.getenv('DB_PORT', '5432'),
        database=os.getenv('DB_NAME', 'ddoksori'),
        user=os.getenv('DB_USER', 'postgres'),
        password=os.getenv('DB_PASSWORD', 'postgres')
    )
    cur = conn.cursor()
    
    # ì„ë² ë”© í•„ìš”í•œ ì²­í¬ ê°€ì ¸ì˜¤ê¸°
    print("\nì„ë² ë”©ì´ í•„ìš”í•œ ì²­í¬ ì¡°íšŒ ì¤‘...")
    cur.execute("""
        SELECT chunk_id, content
        FROM chunks
        WHERE drop = FALSE AND embedding IS NULL
        ORDER BY chunk_id
    """)
    
    chunks = cur.fetchall()
    print(f"âœ… {len(chunks):,}ê°œ ì²­í¬ ë°œê²¬")
    
    if len(chunks) == 0:
        print("ëª¨ë“  ì²­í¬ê°€ ì´ë¯¸ ì„ë² ë”©ë˜ì—ˆìŠµë‹ˆë‹¤!")
        conn.close()
        return
    
    # ëª¨ë¸ ë¡œë“œ
    print("\nëª¨ë¸ ë¡œë“œ ì¤‘...")
    device = torch.device('cuda' if torch.cuda.is_available() else 'cpu')
    print(f"ë””ë°”ì´ìŠ¤: {device}")
    
    model_name = 'nlpai-lab/KURE-v1'
    tokenizer = AutoTokenizer.from_pretrained(model_name)
    model = AutoModel.from_pretrained(model_name).to(device)
    model.eval()
    print("âœ… ëª¨ë¸ ë¡œë“œ ì™„ë£Œ")
    
    # ì„ë² ë”© ìƒì„±
    print(f"\nì„ë² ë”© ìƒì„± ì¤‘... (ì´ {len(chunks):,}ê°œ)")
    chunk_ids = [c[0] for c in chunks]
    contents = [c[1] for c in chunks]
    
    batch_size = 16 if device.type == 'cuda' else 8
    embeddings = get_embeddings(contents, model, tokenizer, device, batch_size)
    
    # DB ì—…ë°ì´íŠ¸
    print("\nDB ì—…ë°ì´íŠ¸ ì¤‘...")
    for chunk_id, embedding in tqdm(zip(chunk_ids, embeddings), total=len(chunk_ids), desc="DB ì—…ë°ì´íŠ¸"):
        cur.execute("""
            UPDATE chunks
            SET embedding = %s, updated_at = NOW()
            WHERE chunk_id = %s
        """, (embedding.tolist(), chunk_id))
        
        # 100ê°œë§ˆë‹¤ ì»¤ë°‹
        if (chunk_ids.index(chunk_id) + 1) % 100 == 0:
            conn.commit()
    
    # ìµœì¢… ì»¤ë°‹
    conn.commit()
    
    # ê²€ì¦
    print("\nê²€ì¦ ì¤‘...")
    cur.execute("""
        SELECT COUNT(*) 
        FROM chunks 
        WHERE drop = FALSE AND embedding IS NULL
    """)
    remaining = cur.fetchone()[0]
    
    print("\n" + "=" * 80)
    print("ì„ë² ë”© ìƒì„± ì™„ë£Œ")
    print("=" * 80)
    print(f"  - ìƒì„±ëœ ì„ë² ë”©: {len(embeddings):,}ê°œ")
    print(f"  - ë‚¨ì€ ì²­í¬: {remaining:,}ê°œ")
    print(f"  - ì„±ê³µë¥ : {(len(embeddings)/(len(embeddings)+remaining)*100):.1f}%")
    
    conn.close()


if __name__ == "__main__":
    main()
```

### 3.3 ì„ë² ë”© ìƒì„± ì‹¤í–‰

```bash
cd /home/maroco/ddoksori_demo/backend/scripts

# GPU ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
conda run -n ddoksori python -c "import torch; print(f'CUDA ì‚¬ìš© ê°€ëŠ¥: {torch.cuda.is_available()}')"

# ì„ë² ë”© ìƒì„± ì‹¤í–‰ (ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¼!)
conda run -n ddoksori python generate_embeddings_incremental.py
```

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**:
- **GPU ì‚¬ìš© ì‹œ**: ì•½ 30-40ë¶„ (4,325ê°œ ì²­í¬)
- **CPU ì‚¬ìš© ì‹œ**: ì•½ 2-3ì‹œê°„

**ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰** (ê¶Œì¥):
```bash
nohup conda run -n ddoksori python generate_embeddings_incremental.py > /tmp/embedding_generation.log 2>&1 &

# ë¡œê·¸ í™•ì¸
tail -f /tmp/embedding_generation.log
```

---

## 4. ì „ì²´ ì‘ì—… ìˆœì„œ (ì²˜ìŒë¶€í„°)

### 4.1 1ë‹¨ê³„: ë°ì´í„° ì‚½ì…

```bash
cd /home/maroco/ddoksori_demo/backend/scripts

# 1. ë²•ë ¹ ë°ì´í„°
conda run -n ddoksori python backend/scripts/data_loading/process_all_laws.py

# 2. ê¸°ì¤€ ë°ì´í„°
conda run -n ddoksori python backend/scripts/data_loading/process_criteria_tables.py

# 3. ë©”íƒ€ë°ì´í„° í‚¤ì›Œë“œ
conda run -n ddoksori python backend/scripts/utilities/update_metadata_keywords.py
```

**ì†Œìš” ì‹œê°„**: ì•½ 10-15ë¶„

### 4.2 2ë‹¨ê³„: ì„ë² ë”© ìƒì„±

```bash
cd /home/maroco/ddoksori_demo/backend/scripts

# ì„ë² ë”© ìƒì„± (ë°±ê·¸ë¼ìš´ë“œ)
nohup conda run -n ddoksori python generate_embeddings_incremental.py > /tmp/embedding_generation.log 2>&1 &

# ì§„í–‰ ìƒí™© ëª¨ë‹ˆí„°ë§
tail -f /tmp/embedding_generation.log
```

**ì†Œìš” ì‹œê°„**: GPU ê¸°ì¤€ ì•½ 30-40ë¶„

### 4.3 3ë‹¨ê³„: ê²€ì¦

```bash
cd /home/maroco/ddoksori_demo/backend

# ìµœì¢… ìƒíƒœ í™•ì¸
conda run -n ddoksori python -c "
import psycopg2
import os
from dotenv import load_dotenv

load_dotenv()
conn = psycopg2.connect(
    host=os.getenv('DB_HOST', 'localhost'),
    port=os.getenv('DB_PORT', '5432'),
    database=os.getenv('DB_NAME', 'ddoksori'),
    user=os.getenv('DB_USER', 'postgres'),
    password=os.getenv('DB_PASSWORD', 'postgres')
)
cur = conn.cursor()

print('ìµœì¢… ê²€ì¦ ê²°ê³¼')
print('=' * 60)

# ì „ì²´ í†µê³„
cur.execute('SELECT COUNT(*) FROM documents')
total_docs = cur.fetchone()[0]
cur.execute('SELECT COUNT(*) FROM chunks WHERE drop=FALSE')
total_chunks = cur.fetchone()[0]
cur.execute('SELECT COUNT(*) FROM chunks WHERE drop=FALSE AND embedding IS NOT NULL')
embedded_chunks = cur.fetchone()[0]

print(f'ì´ ë¬¸ì„œ: {total_docs:,}ê°œ')
print(f'ì´ ì²­í¬: {total_chunks:,}ê°œ')
print(f'ì„ë² ë”© ì²­í¬: {embedded_chunks:,}ê°œ')
print(f'ì„ë² ë”© ì»¤ë²„ë¦¬ì§€: {embedded_chunks/total_chunks*100:.1f}%')

# ë©”íƒ€ë°ì´í„° í‚¤ì›Œë“œ
cur.execute(\"\"\"
    SELECT COUNT(*) 
    FROM documents 
    WHERE metadata ? 'keywords'
\"\"\")
keyword_docs = cur.fetchone()[0]
print(f'í‚¤ì›Œë“œ ë©”íƒ€ë°ì´í„°: {keyword_docs}/{total_docs} ({keyword_docs/total_docs*100:.1f}%)')

conn.close()

print('=' * 60)
print('âœ… ëª¨ë“  ì‘ì—… ì™„ë£Œ!' if embedded_chunks == total_chunks else 'âš ï¸  ì„ë² ë”© ìƒì„± í•„ìš”')
"
```

---

## 5. ë¬¸ì œ í•´ê²°

### 5.1 "ì•„ë¬´ ì¼ë„ ì•ˆ ì¼ì–´ë‚¨" (í˜„ì¬ ìƒí™©)

**ì›ì¸**: ì´ë¯¸ DBì— ë°ì´í„°ê°€ ìˆìŒ (ì¤‘ë³µ ì²´í¬)

**í™•ì¸**:
```bash
cd /home/maroco/ddoksori_demo/backend/scripts
conda run -n ddoksori python backend/scripts/data_loading/process_all_laws.py
```

**ê²°ê³¼**:
```
  âš ï¸  ë¬¸ì„œ ì´ë¯¸ ì¡´ì¬: law:civil_law_chunks (ìŠ¤í‚µ)
  ...
  - ì‚½ì…ëœ ë¬¸ì„œ: 0ê°œ  â† ì •ìƒ!
```

**í•´ê²°**: ë°ì´í„°ëŠ” ì´ë¯¸ ìˆìœ¼ë‹ˆ, **ì„ë² ë”© ìƒì„±**ìœ¼ë¡œ ë„˜ì–´ê°€ì„¸ìš”!

### 5.2 "DB ì—°ê²° ì‹¤íŒ¨"

**ì›ì¸**: PostgreSQL ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì´ì§€ ì•ŠìŒ

**í•´ê²°**:
```bash
# Dockerë¡œ PostgreSQL ì‹¤í–‰
cd /home/maroco/ddoksori_demo
docker-compose up -d postgres

# í™•ì¸
docker ps | grep postgres
```

### 5.3 "ëª¨ë¸ ë¡œë“œ ì‹¤íŒ¨"

**ì›ì¸**: KURE-v1 ëª¨ë¸ì´ ë‹¤ìš´ë¡œë“œë˜ì§€ ì•ŠìŒ

**í•´ê²°**:
```bash
conda run -n ddoksori python -c "
from transformers import AutoModel, AutoTokenizer

model_name = 'nlpai-lab/KURE-v1'
print('ëª¨ë¸ ë‹¤ìš´ë¡œë“œ ì¤‘...')
tokenizer = AutoTokenizer.from_pretrained(model_name)
model = AutoModel.from_pretrained(model_name)
print('âœ… ë‹¤ìš´ë¡œë“œ ì™„ë£Œ')
"
```

### 5.4 "ë©”ëª¨ë¦¬ ë¶€ì¡±"

**ì›ì¸**: GPU/CPU ë©”ëª¨ë¦¬ ë¶€ì¡±

**í•´ê²°**: ë°°ì¹˜ í¬ê¸° ì¤„ì´ê¸°
```python
# generate_embeddings_incremental.pyì—ì„œ
batch_size = 4  # ê¸°ë³¸ê°’ 8 â†’ 4ë¡œ ì¤„ì„
```

---

## 6. ë‹¤ìŒ ë‹¨ê³„

### 6.1 ì„ë² ë”© ìƒì„± í›„

1. **í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸**
   ```bash
   cd /home/maroco/ddoksori_demo/backend/scripts
   conda run -n ddoksori python backend/scripts/evaluation/evaluate_hybrid_search.py
   ```

2. **RAG ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸**
   ```bash
   cd /home/maroco/ddoksori_demo/backend
   conda run -n ddoksori pytest tests/test_rag.py -v
   ```

3. **API ì„œë²„ ì‹¤í–‰**
   ```bash
   cd /home/maroco/ddoksori_demo/backend
   conda run -n ddoksori uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
   ```

### 6.2 ì„ íƒ ì‚¬í•­

4. **ì¤‘ë³µ ë¯¼ë²• ë°ì´í„° ì •ë¦¬**
   ```sql
   -- statute:001706 (ê¸°ì¡´) ì‚­ì œ
   DELETE FROM documents WHERE doc_id = 'statute:001706';
   ```

5. **Golden Dataset ì—…ë°ì´íŠ¸**
   - table1 í’ˆëª© ì •ë³´ë¥¼ í™œìš©í•œ ìƒˆ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì¶”ê°€

---

## 7. ë¹ ë¥¸ ì°¸ì¡°

### 7.1 í˜„ì¬ ìƒíƒœ í™•ì¸

```bash
cd /home/maroco/ddoksori_demo/backend
conda run -n ddoksori python -c "
import psycopg2, os
from dotenv import load_dotenv
load_dotenv()
conn = psycopg2.connect(
    host=os.getenv('DB_HOST', 'localhost'),
    port=os.getenv('DB_PORT', '5432'),
    database=os.getenv('DB_NAME', 'ddoksori'),
    user=os.getenv('DB_USER', 'postgres'),
    password=os.getenv('DB_PASSWORD', 'postgres')
)
cur = conn.cursor()
cur.execute('SELECT COUNT(*) FROM documents')
docs = cur.fetchone()[0]
cur.execute('SELECT COUNT(*) FROM chunks WHERE drop=FALSE AND embedding IS NULL')
need_emb = cur.fetchone()[0]
print(f'ë¬¸ì„œ: {docs:,}ê°œ')
print(f'ì„ë² ë”© í•„ìš”: {need_emb:,}ê°œ ì²­í¬')
print('âœ… ì™„ë£Œ' if need_emb == 0 else 'âš ï¸ ì„ë² ë”© ìƒì„± í•„ìš”')
conn.close()
"
```

### 7.2 ìŠ¤í¬ë¦½íŠ¸ ìœ„ì¹˜

```
backend/scripts/
â”œâ”€â”€ data_loading/
â”‚   â”œâ”€â”€ process_all_laws.py          â† ë²•ë ¹ ë°ì´í„° ì²˜ë¦¬
â”‚   â””â”€â”€ process_criteria_tables.py   â† ê¸°ì¤€ ë°ì´í„° ì²˜ë¦¬
â”œâ”€â”€ utilities/
â”‚   â””â”€â”€ update_metadata_keywords.py  â† ë©”íƒ€ë°ì´í„° í‚¤ì›Œë“œ
â””â”€â”€ generate_embeddings_incremental.py  â† ì„ë² ë”© ìƒì„± (ì‘ì„± í•„ìš”)
```

---

**ì‘ì„±ì**: AI Assistant  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2026ë…„ 1ì›” 7ì¼  
**ì°¸ê³  ë¬¸ì„œ**: [`ê¸´ê¸‰_ì¡°ì¹˜_ì™„ë£Œ_ë³´ê³ ì„œ_2026-01-07.md`](./ê¸´ê¸‰_ì¡°ì¹˜_ì™„ë£Œ_ë³´ê³ ì„œ_2026-01-07.md)
